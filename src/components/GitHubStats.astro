---
import { githubStats } from "../data/github";
import {
	GitCommit,
	Star,
	GitPullRequest,
	Users,
	TrendingUp,
	Calendar,
} from "lucide-react";

const { stats, prs, stars } = githubStats;

interface MetricCard {
	label: string;
	value: string | number;
	icon: any;
}
const metricCards: MetricCard[] = [
	{
		label: "Commits",
		value: stats.totalCommits.toLocaleString(),
		icon: GitCommit,
	},
	{ label: "Stars", value: stars.total_stars.toLocaleString(), icon: Star },
	{ label: "PRs", value: prs.length, icon: GitPullRequest },
	{ label: "Current Streak", value: stats.currentStreak, icon: TrendingUp },
	{ label: "Longest Streak", value: stats.longestStreak, icon: Calendar },
	{
		label: "Views",
		value: stats.profile_visitors.toLocaleString(),
		icon: Users,
	},
];

const languageUsage = stats.topLanguages
	.slice(0, 8)
	.map((l) => ({ name: l.name, value: l.percentage }));
const starredRepos = stars.repositories.slice(0, 6);
const organizationStats = [
	{ label: "Orgs", value: githubStats.orgContributions.length },
	{ label: "PRs", value: prs.length },
];
---

<div class="space-y-10">
	<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
		{
			metricCards.map((m) => (
				<div class="flex flex-col gap-1 border-2 p-3 bg-card">
					<div class="h-8 w-8 flex items-center justify-center border-2 mb-1">
						<m.icon className="h-4 w-4" />
					</div>
					<p class="text-[10px] font-medium uppercase tracking-wide text-muted-foreground">
						{m.label}
					</p>
					<p class="text-lg font-bold leading-none">{m.value}</p>
				</div>
			))
		}
	</div>

	<div class="space-y-4">
		<h2 class="text-sm font-semibold tracking-tight">Language Usage</h2>
		<div class="flex flex-col md:flex-row gap-8">
			<div class="flex-1 space-y-3">
				{
					languageUsage.map((lang) => (
						<div class="flex items-center gap-3">
							<div class="w-full h-2 border-2 bg-muted relative overflow-hidden">
								<div
									class="absolute inset-y-0 left-0 bg-primary"
									style={{ width: `${lang.value}%` }}
								/>
							</div>
							<div class="flex items-center gap-2 w-40">
								<span class="text-xs font-medium">{lang.name}</span>
								<span class="text-[10px] text-muted-foreground">
									{lang.value}%
								</span>
							</div>
						</div>
					))
				}
			</div>
			<div class="w-full md:w-1/4">
				<div class="aspect-square flex items-center justify-center border-2">
					<div class="text-center p-4">
						<p class="text-[11px] text-muted-foreground">Languages</p>
						<p class="text-2xl font-bold leading-none">
							{languageUsage.length}
						</p>
					</div>
				</div>
			</div>
		</div>
	</div>

	{
		starredRepos.length > 0 && (
			<div class="space-y-4">
				<h2 class="text-sm font-semibold tracking-tight">
					Starred Repositories
				</h2>
				<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
					{starredRepos.map((repo) => (
						<a
							href={repo.url}
							target="_blank"
							rel="noopener noreferrer"
							class="flex flex-col gap-3 border-2 p-4 bg-card hover:bg-accent/30 transition-colors"
						>
							<div class="flex items-start justify-between gap-2">
								<h3 class="text-sm font-semibold leading-tight line-clamp-2">
									{repo.name}
								</h3>
								<div class="flex items-center gap-1 text-muted-foreground text-[10px]">
									<Star size={12} />
									<span>{repo.stars}</span>
								</div>
							</div>
							{repo.description && (
								<p class="text-[11px] text-muted-foreground line-clamp-3 leading-snug">
									{repo.description}
								</p>
							)}
							<p class="text-[10px] text-muted-foreground mt-auto">
								{repo.language || "â€”"}
							</p>
						</a>
					))}
				</div>
			</div>
		)
	}

	{
		organizationStats.length > 0 && (
			<div class="space-y-4">
				<h2 class="text-sm font-semibold tracking-tight">Organization</h2>
				<div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
					{organizationStats.map((s) => (
						<div class="flex flex-col gap-1 border-2 p-3 bg-card">
							<p class="text-[10px] font-medium uppercase tracking-wide text-muted-foreground">
								{s.label}
							</p>
							<p class="text-lg font-bold leading-none">{s.value}</p>
						</div>
					))}
				</div>
			</div>
		)
	}
</div>
