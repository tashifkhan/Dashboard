# Docker Images & Build Process

> Source: https://deepwiki.com/harleenkaur28/AI-Resume-Parser/6.2-docker-images-and-build-process

# Docker Images & Build Process

Relevant source files

* [backend/Dockerfile](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile)
* [docker-compose.prod.yaml](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml)
* [docker-compose.yaml](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.yaml)
* [frontend/.dockerignore](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/.dockerignore)
* [frontend/Dockerfile](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile)
* [frontend/components/pdf-resume/LoadingOverlay.tsx](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/components/pdf-resume/LoadingOverlay.tsx)
* [frontend/instrumentation-client.ts](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/instrumentation-client.ts)

## Purpose and Scope

This document describes the Docker image build configurations for TalentSync's frontend and backend services, including the multi-stage build process, dependency management, environment variable handling, and optimization techniques. For information about how these images are orchestrated together, see [Docker Compose Setup](/harleenkaur28/AI-Resume-Parser/6.1-docker-compose-setup). For CI/CD deployment automation, see [CI/CD Pipeline](/harleenkaur28/AI-Resume-Parser/6.3-cicd-pipeline).

---

## Overview

TalentSync uses two custom Docker images:

| Image | Base Image | Build Strategy | Final Size Optimization |
| --- | --- | --- | --- |
| Frontend | `oven/bun:1` â†’ `oven/bun:1-slim` | Multi-stage build | Slim runner image, production deps only |
| Backend | `python:3.13-slim` | Single-stage build | Slim base, uv package manager |

Both images are built from their respective Dockerfiles and orchestrated via Docker Compose configurations.

**Build Process Flow**

![Architecture Diagram](images/6.2-docker-images-and-build-process_diagram_1.png)
```

Sources: [frontend/Dockerfile1-125](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L1-L125) [backend/Dockerfile1-33](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L1-L33)

---

## Frontend Docker Image

### Multi-Stage Build Architecture

The frontend uses a two-stage build to minimize final image size while maintaining all build-time dependencies.

**Stage Architecture**

```
![Architecture Diagram](images/6.2-docker-images-and-build-process_diagram_2.png)
```

Sources: [frontend/Dockerfile1-99](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L1-L99)

### Builder Stage

The builder stage ([frontend/Dockerfile2-48](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L2-L48)) uses the full `oven/bun:1` image and performs the complete build process:

```
```
FROM oven/bun:1 AS builder
```
```

**Key operations:**

1. **System dependencies installation** ([frontend/Dockerfile22-30](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L22-L30)): Installs `openssl` for Prisma and `texlive` packages for PDF generation capabilities
2. **Build argument handling** ([frontend/Dockerfile10-18](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L10-L18)): Accepts `NEXT_PUBLIC_*` variables as build args and converts them to environment variables for Next.js to embed in the client bundle
3. **File copying** ([frontend/Dockerfile33](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L33-L33)): Copies entire application context
4. **Ownership setup** ([frontend/Dockerfile36-39](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L36-L39)): Changes ownership to `bun` user for security
5. **Dependency installation** ([frontend/Dockerfile43](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L43-L43)): Runs `bun install --frozen-lockfile` to ensure reproducible builds
6. **Application build** ([frontend/Dockerfile48](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L48-L48)): Executes `bun run build`, which includes `prisma generate` and `next build`

**Build Arguments**

The builder stage accepts three build arguments for embedding into the Next.js bundle:

| Argument | Purpose | Embedded At |
| --- | --- | --- |
| `NEXT_PUBLIC_POSTHOG_KEY` | PostHog analytics project key | Build time |
| `NEXT_PUBLIC_POSTHOG_UI_HOST` | PostHog UI host URL | Build time |
| `NEXT_PUBLIC_POSTHOG_HOST` | PostHog API host URL | Build time |

These are passed via `docker-compose.prod.yaml` ([docker-compose.prod.yaml37-40](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L37-L40)).

Sources: [frontend/Dockerfile2-48](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L2-L48)

### Runner Stage

The runner stage ([frontend/Dockerfile50-98](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L50-L98)) uses the slim image variant to reduce final image size:

```
```
FROM oven/bun:1-slim AS runner
```
```

**Optimization techniques:**

1. **Slim base image**: `oven/bun:1-slim` includes only runtime essentials
2. **Selective copying**: Only copies necessary files from builder:
   * `package.json` and `bun.lock` ([frontend/Dockerfile71-72](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L71-L72))
   * `prisma/` directory for database operations ([frontend/Dockerfile73](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L73-L73))
   * `.next/` build output ([frontend/Dockerfile87](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L87-L87))
   * `public/` static assets ([frontend/Dockerfile88](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L88-L88))
   * `next.config.js` for runtime configuration ([frontend/Dockerfile91](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L91-L91))
3. **Production dependencies only** ([frontend/Dockerfile84](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L84-L84)): `bun install --production --frozen-lockfile` excludes devDependencies
4. **Non-root user**: Runs as `bun` user ([frontend/Dockerfile80](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L80-L80)) for security

**Runtime command:**

```
```
CMD ["bun", "run", "start"]
```
```

This is overridden in `docker-compose.yaml` ([docker-compose.yaml63](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.yaml#L63-L63)) to run migrations and seeding before starting:

```
```
sh -c "bunx prisma migrate deploy && bun prisma/seed.ts && bun run start"
```
```

Sources: [frontend/Dockerfile50-99](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L50-L99) [docker-compose.yaml63](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.yaml#L63-L63)

### Environment Variable Handling

The frontend image requires two types of environment variables:

**1. Build-time variables (NEXT\_PUBLIC\_\*)**

These must be available during `docker build` and are embedded into the JavaScript bundle:

```
![Architecture Diagram](images/6.2-docker-images-and-build-process_diagram_3.png)
```

Specified in [docker-compose.prod.yaml37-40](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L37-L40):

```
```
args:
  NEXT_PUBLIC_POSTHOG_KEY: ${NEXT_PUBLIC_POSTHOG_KEY}
  NEXT_PUBLIC_POSTHOG_UI_HOST: ${NEXT_PUBLIC_POSTHOG_UI_HOST:-https://eu.posthog.com}
  NEXT_PUBLIC_POSTHOG_HOST: ${NEXT_PUBLIC_POSTHOG_HOST:-https://eu.i.posthog.com}
```
```

**2. Runtime variables**

These are provided when the container starts and include:

| Variable | Purpose | Source |
| --- | --- | --- |
| `NEXTAUTH_URL` | NextAuth callback URL | [docker-compose.prod.yaml46](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L46-L46) |
| `NEXTAUTH_SECRET` | Session encryption key | `.env` file |
| `DATABASE_URL` | Prisma connection string | Composed from POSTGRES\_\* vars |
| `BACKEND_URL` | Internal backend service URL | [docker-compose.prod.yaml48](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L48-L48) |
| OAuth credentials | Google/GitHub OAuth | `.env` file |
| Email settings | Nodemailer configuration | `.env` file |

Runtime variables are loaded via `env_file` ([docker-compose.prod.yaml42-43](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L42-L43)) and explicit `environment` overrides.

Sources: [frontend/Dockerfile100-125](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L100-L125) [docker-compose.prod.yaml33-55](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L33-L55)

---

## Backend Docker Image

### Build Process

The backend uses a single-stage build with the slim Python base image:

```
![Architecture Diagram](images/6.2-docker-images-and-build-process_diagram_4.png)
```

Sources: [backend/Dockerfile1-33](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L1-L33)

**Build stages:**

1. **Base image selection** ([backend/Dockerfile2](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L2-L2)): Uses `python:3.13-slim` for minimal footprint
2. **Environment configuration** ([backend/Dockerfile5-6](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L5-L6)):

   ```
   ```
   ENV PYTHONUNBUFFERED=1
   ENV NLTK_DATA=/app/model/nltk_data
   ```
   ```
3. **uv package manager** ([backend/Dockerfile12](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L12-L12)): Installs `uv` for faster dependency resolution
4. **Dependency installation** ([backend/Dockerfile17-22](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L17-L22)):
   * Copies `pyproject.toml` first for Docker layer caching
   * Runs `uv pip install --system --no-cache ".[dev]"` to install all dependencies including uvicorn
   * Uses `--system` flag to install globally (no virtual env)
   * Uses `--no-cache` to reduce image size
5. **Application code** ([backend/Dockerfile25](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L25-L25)): Copies `app/` directory containing all Python modules
6. **Runtime command** ([backend/Dockerfile32](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L32-L32)): Starts uvicorn server on all interfaces

### Dependency Management

The backend uses `pyproject.toml` to define dependencies, with `uv` as the installer:

```
![Architecture Diagram](images/6.2-docker-images-and-build-process_diagram_5.png)
```

**Key dependency groups:**

* **FastAPI & Uvicorn**: Web framework and ASGI server ([backend/Dockerfile20-22](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L20-L22))
* **LangChain ecosystem**: LLM orchestration and agent frameworks
* **ML libraries**: scikit-learn, nltk, spacy for NLP processing
* **File processing**: PyPDF2, python-docx for resume parsing

The `[dev]` group is included to ensure uvicorn is available ([backend/Dockerfile20](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L20-L20)).

Sources: [backend/Dockerfile12-22](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L12-L22)

### Runtime Configuration

**Environment variables:**

```
```
ENV PYTHONUNBUFFERED=1
ENV NLTK_DATA=/app/model/nltk_data
```
```

* `PYTHONUNBUFFERED=1` ([backend/Dockerfile5](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L5-L5)): Forces Python stdout/stderr to be unbuffered for real-time logs
* `NLTK_DATA` ([backend/Dockerfile6](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L6-L6)): Specifies location for NLTK data files

**Volume mounts:**

The backend requires a volume mount for file persistence ([docker-compose.prod.yaml26](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L26-L26)):

```
```
volumes:
  - ./backend/uploads:/app/uploads
```
```

This persists uploaded resumes across container restarts.

**Port exposure:**

```
```
EXPOSE 8000
```
```

The backend listens on port 8000 internally ([backend/Dockerfile28](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L28-L28)), which is accessed by the frontend via the internal Docker network as `http://backend:8000`.

Sources: [backend/Dockerfile5-6](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L5-L6) [backend/Dockerfile28-32](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L28-L32) [docker-compose.prod.yaml16-31](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L16-L31)

---

## Image Size Optimization

Both images employ multiple optimization strategies:

**Frontend optimizations:**

| Technique | Implementation | Size Impact |
| --- | --- | --- |
| Multi-stage build | Separate builder and runner stages | ~60% reduction |
| Slim base image | `oven/bun:1-slim` vs `oven/bun:1` | ~40% smaller base |
| Production dependencies | `--production` flag excludes devDependencies | ~30% fewer deps |
| Selective copying | Only copy built artifacts, not source | Minimal source code |

**Backend optimizations:**

| Technique | Implementation | Size Impact |
| --- | --- | --- |
| Slim base image | `python:3.13-slim` vs `python:3.13` | ~70% smaller base |
| No cache installs | `--no-cache` flag | No pip cache layer |
| Layer ordering | Copy pyproject.toml before app code | Better layer caching |
| System install | `--system` avoids virtualenv overhead | Slight reduction |

**Build context optimization:**

The `.dockerignore` file ([frontend/.dockerignore1-53](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/.dockerignore#L1-L53)) excludes unnecessary files from the Docker build context:

```
node_modules/           # 44-52)Dependencies
.next/                  # Build output
.env*                   # Environment files
.git/                   # Git history
*.md                    # Documentation
**/*.test.*             # Tests
coverage/               # Test coverage
```

This reduces the amount of data sent to the Docker daemon during builds.

Sources: [frontend/Dockerfile1-125](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L1-L125) [backend/Dockerfile1-33](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L1-L33) [frontend/.dockerignore1-53](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/.dockerignore#L1-L53)

---

## Integration with Docker Compose

The images are built and orchestrated by Docker Compose configurations:

**Build configuration mapping:**

```
![Architecture Diagram](images/6.2-docker-images-and-build-process_diagram_6.png)
```

**Service build specifications:**

Frontend service ([docker-compose.prod.yaml33-55](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L33-L55)):

```
```
frontend:
  build:
    context: ./frontend
    dockerfile: Dockerfile
    args:
      NEXT_PUBLIC_POSTHOG_KEY: ${NEXT_PUBLIC_POSTHOG_KEY}
      NEXT_PUBLIC_POSTHOG_UI_HOST: ${NEXT_PUBLIC_POSTHOG_UI_HOST:-https://eu.posthog.com}
      NEXT_PUBLIC_POSTHOG_HOST: ${NEXT_PUBLIC_POSTHOG_HOST:-https://eu.i.posthog.com}
```
```

Backend service ([docker-compose.prod.yaml16-31](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L16-L31)):

```
```
backend:
  build:
    context: ./backend
    dockerfile: Dockerfile
```
```

**Network architecture:**

The production compose file ([docker-compose.prod.yaml61-66](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L61-L66)) defines two networks:

1. **talentsync\_internal\_network**: Internal bridge network for service-to-service communication
2. **nginxproxyman\_network**: External network for Nginx Proxy Manager integration (see [Docker Compose Setup](/harleenkaur28/AI-Resume-Parser/6.1-docker-compose-setup))

**Build command:**

To build all images:

```
```
docker compose -f docker-compose.prod.yaml build
```
```

To build a specific service:

```
```
docker compose -f docker-compose.prod.yaml build frontend
```
```

Sources: [docker-compose.prod.yaml1-66](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L1-L66) [docker-compose.yaml1-78](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.yaml#L1-L78)

---

## Build-Time vs Runtime Dependencies

**Frontend dependencies:**

```
![Architecture Diagram](images/6.2-docker-images-and-build-process_diagram_7.png)

The multi-stage build ensures that build tools and devDependencies never make it into the final image.

**Backend dependencies:**

The backend includes all dependencies in a single stage ([backend/Dockerfile20](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L20-L20)):

```
```
RUN uv pip install --system --no-cache ".[dev]"
```
```

This includes both runtime dependencies (FastAPI, LangChain) and the dev group (uvicorn server), as the server itself is technically a dev dependency.

Sources: [frontend/Dockerfile43-48](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L43-L48) [frontend/Dockerfile84](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L84-L84) [backend/Dockerfile20](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L20-L20)

---

## Summary

**Image characteristics:**

| Aspect | Frontend | Backend |
| --- | --- | --- |
| Build strategy | Multi-stage | Single-stage |
| Base image | `oven/bun:1-slim` | `python:3.13-slim` |
| Package manager | bun | uv (pip) |
| Exposed port | 3000 | 8000 |
| User | bun (non-root) | root |
| Runtime command | `bun run start` | `uvicorn app.main:app` |
| Build args | 3 (NEXT\_PUBLIC\_\*) | None |
| Volume mounts | None | uploads/ |

**Build optimization summary:**

Both images prioritize:

1. **Minimal base images**: Slim variants reduce attack surface and size
2. **Layer caching**: Dependencies installed before app code for cache efficiency
3. **Production artifacts**: Only necessary files included in final image
4. **Security**: Frontend runs as non-root user
5. **Reproducibility**: Lockfiles ensure consistent builds

Sources: [frontend/Dockerfile1-125](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/frontend/Dockerfile#L1-L125) [backend/Dockerfile1-33](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/backend/Dockerfile#L1-L33) [docker-compose.prod.yaml1-66](https://github.com/harleenkaur28/AI-Resume-Parser/blob/b2bbd83d/docker-compose.prod.yaml#L1-L66)