---
import Layout from "../layouts/Layout.astro";
import ProjectFilters from "../components/ProjectFilters.tsx";
import { starLists } from "../data/starLists";
import BlogFilters from "../components/BlogFilters";
import BlogCard from "../components/BlogCard.astro";
import LeetCodeStats from "../components/LeetCodeStats.astro";
import GitHubStats from "../components/GitHubStats.astro";
import LeetCodeContests from "../components/LeetCodeContests.astro";
import LeetCodeBadges from "../components/LeetCodeBadges.astro";
import Resume from "../components/Resume.astro";
import {
	Github,
	Twitter,
	Linkedin,
	Mail,
	Code2,
	FolderOpen,
	BookOpen,
	Users,
	ExternalLink,
	Globe,
	FileText,
	ArrowUp,
	Trophy,
	BarChart3,
} from "lucide-react";
import { allProjects, type Project } from "../data/projects";
import { leetCodeData } from "../data/leetcode";
import { githubStats } from "../data/github";
import ProjectCard from "../components/ProjectCard.astro";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Label } from "@/components/ui/label";
import { Badge } from "@/components/ui/badge";

import ThemeToggle from "@/components/ThemeToggle";

const projects: Project[] = allProjects;

// Fetch blog posts from external API
type RemotePost = {
	title: string;
	date: string; // ISO date
	author: string;
	socials: string[];
	tags: string[];
	excerpt: string;
	slug: string;
	wordCount?: number;
	readingTimeMinutes?: number;
};

let blogPosts: RemotePost[] = [];
try {
	const res = await fetch("https://blog.tashif.codes/api/posts.json");
	if (res.ok) {
		blogPosts = (await res.json()) as RemotePost[];
		// Sort posts by date desc to ensure the latest is featured first
		blogPosts.sort(
			(a, b) => new Date(b.date).getTime() - new Date(a.date).getTime()
		);
	} else {
		console.error(
			"Failed to fetch remote blog posts:",
			res.status,
			res.statusText
		);
	}
} catch (err) {
	console.error("Error fetching remote blog posts:", err);
}
const { profile } = leetCodeData;
const { stats, stars } = githubStats;

const numProjects = projects.length;
const numBlogPosts = blogPosts.length;
const totalCommits = stats?.totalCommits ?? 0;
const totalSolved = leetCodeData?.stats?.totalSolved ?? 0;
const liveProjectCount = projects.filter((p) => p.live_website_url).length;
const latestBlogDate = blogPosts[0]?.date ? new Date(blogPosts[0].date) : null;

// Use tags from remote posts as categories for filtering
const blogCategories = [
	...new Set(
		blogPosts.flatMap((post) => (Array.isArray(post.tags) ? post.tags : []))
	),
];

// Aggregate metrics from the remote posts (new API includes wordCount & readingTimeMinutes)
const totalBlogWords = blogPosts.reduce(
	(sum, p) => sum + (p.wordCount || 0),
	0
);
const avgReadingMinutes = blogPosts.length
	? Math.round(
			blogPosts.reduce((s, p) => s + (p.readingTimeMinutes || 0), 0) /
				blogPosts.length
		)
	: 0;

const socials = [
	{ icon: Github, link: "https://github.com/tashifkhan", label: "GitHub" },
	{ icon: Globe, link: "https://portfolio.tashif.codes", label: "Portfolio" },
	{
		icon: Linkedin,
		link: "https://www.linkedin.com/in/tashifkhan/",
		label: "LinkedIn",
	},
	{
		icon: Twitter,
		link: "https://twitter.com/khan_tashif_",
		label: "Twitter",
	},
	{ icon: Mail, link: "mailto:tashif@duck.com", label: "Email" },
];
---

<Layout title="Tashif Ahmad Khan - Personal Dashboard">
	<div
		class="relative min-h-screen bg-background text-gray-900 dark:text-gray-100 transition-colors duration-300 font-sans scroll-smooth"
	>
		<div
			class="pointer-events-none absolute inset-0 [mask-image:radial-gradient(80%_60%_at_50%_0%,black,transparent)]"
		>
			<div
				class="h-40 bg-gradient-to-b from-orange-200/40 to-transparent dark:from-orange-900/20"
			>
			</div>
		</div>
		<!-- Header -->
		<header
			class="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-white/70 dark:supports-[backdrop-filter]:bg-gray-900/60 bg-white/80 dark:bg-gray-900/70 border-b border-gray-200/60 dark:border-gray-800/60 shadow-sm"
		>
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 sm:py-4">
				<div
					class="flex flex-col sm:flex-row justify-between items-center gap-4"
				>
					<div class="flex items-center space-x-5 overflow-visible">
						<span
							class="p-[2px] rounded-full bg-gradient-to-tr from-primary via-primary/80 to-primary/60"
						>
							<span
								class="block rounded-full bg-white dark:bg-gray-900 p-[2px]"
							>
								<img
									src="https://avatars.githubusercontent.com/u/75897907?v=4"
									alt="Tashif Ahmad Khan"
									class="w-14 h-14 sm:w-16 sm:h-16 rounded-full object-cover block"
								/>
							</span>
						</span>
						<div>
							<h1
								class="text-2xl sm:text-3xl font-bold tracking-tight bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent"
							>
								Tashif Ahmad Khan
							</h1>
							<p class="text-gray-600 dark:text-gray-300 text-sm">
								{profile.realName || "Software Developer"}
							</p>
						</div>
					</div>
					<div class="flex items-center space-x-1.5 sm:space-x-2">
						{
							socials.map((social) => (
								<Button
									variant="ghost"
									size="icon"
									asChild
									className="rounded-full"
								>
									<a
										href={social.link}
										target="_blank"
										rel="noopener noreferrer"
										aria-label={social.label}
									>
										<social.icon size={20} />
									</a>
								</Button>
							))
						}
						<ThemeToggle client:load />
					</div>
				</div>
			</div>
		</header>

		<!-- Navigation (Styled as Shadcn Tabs) -->
		<nav
			class="sticky top-[56px] sm:top-[64px] z-30 backdrop-blur supports-[backdrop-filter]:bg-white/70 dark:supports-[backdrop-filter]:bg-gray-900/60 bg-white/80 dark:bg-gray-900/70 border-b border-gray-200/60 dark:border-gray-800/60 transition-colors duration-300 overflow-x-auto font-sans no-scrollbar"
		>
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-2">
				<div
					class="inline-flex h-10 items-center justify-start rounded-md bg-muted p-1 text-muted-foreground w-full sm:w-auto overflow-x-auto no-scrollbar"
					style="overflow-x: auto !important;"
				>
					<button
						id="projects-tab"
						class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm hover:text-foreground shrink-0"
						data-state="active"
					>
						<FolderOpen size={16} className="mr-2" />
						Projects
					</button>
					<button
						id="blog-tab"
						class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm hover:text-foreground shrink-0"
						data-state="inactive"
					>
						<BookOpen size={16} className="mr-2" />
						Blog
					</button>
					<button
						id="leetcode-tab"
						class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm hover:text-foreground shrink-0"
						data-state="inactive"
					>
						<Code2 size={16} className="mr-2" />
						LeetCode
					</button>
					<button
						id="github-tab"
						class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm hover:text-foreground shrink-0"
						data-state="inactive"
					>
						<Github size={16} className="mr-2" />
						GitHub
					</button>
					<button
						id="resume-tab"
						class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm hover:text-foreground shrink-0"
						data-state="inactive"
					>
						<FileText size={16} className="mr-2" />
						Resume
					</button>
					<button
						id="community-tab"
						class="inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm hover:text-foreground shrink-0"
						data-state="inactive"
					>
						<Users size={16} className="mr-2" />
						Community
					</button>
				</div>
			</div>
		</nav>

		<!-- Main Content -->
		<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
			<!-- Welcome restore pill (shown when banner is hidden) -->
			<div id="welcome-restore" class="mb-4 hidden">
				<Button
					id="welcome-restore-btn"
					variant="outline"
					size="sm"
					className="rounded-full bg-white/60 dark:bg-gray-900/60"
					aria-controls="welcome-banner"
				>
					<span class="inline-block h-2 w-2 rounded-full bg-orange-500 mr-2"
					></span>
					Show welcome
				</Button>
			</div>

			<!-- Minimal Welcome Banner -->
			<Card
				id="welcome-banner"
				className="mb-8 bg-white/70 dark:bg-gray-900/60 backdrop-blur border-gray-200/60 dark:border-gray-800/60"
			>
				<CardContent className="p-4 sm:p-5">
					<div class="flex items-start justify-between gap-3">
						<div class="min-w-0">
							<h2
								class="text-base sm:text-lg font-semibold tracking-tight mb-1"
							>
								Welcome
							</h2>
							<p class="text-gray-600 dark:text-gray-300 text-sm">
								Quick snapshot across Projects, Blog, GitHub and LeetCode.
							</p>
						</div>
						<Button
							id="welcome-dismiss"
							variant="ghost"
							size="icon"
							className="h-8 w-8"
							aria-label="Dismiss welcome"
							aria-controls="welcome-banner"
						>
							<span aria-hidden="true">×</span>
						</Button>
					</div>
					<div class="mt-3 flex flex-wrap items-center gap-2">
						<!-- Compact stats pills -->
						<Badge
							variant="outline"
							className="bg-white/60 dark:bg-gray-900/60 font-normal"
						>
							<Code2 size={14} className="text-primary mr-1.5" />
							{numProjects} Projects
						</Badge>
						<Badge
							variant="outline"
							className="bg-white/60 dark:bg-gray-900/60 font-normal"
						>
							<BookOpen size={14} className="text-primary mr-1.5" />
							{numBlogPosts} Posts
						</Badge>
						<Badge
							variant="outline"
							className="bg-white/60 dark:bg-gray-900/60 font-normal"
						>
							<Github size={14} className="text-primary mr-1.5" />
							{totalCommits} Commits
						</Badge>
						<Badge
							variant="outline"
							className="bg-white/60 dark:bg-gray-900/60 font-normal"
						>
							<Code2 size={14} className="text-primary mr-1.5" />
							{totalSolved} Solved
						</Badge>

						<!-- Tiny actions -->
						<span class="ml-auto inline-flex items-center gap-1">
							<Button
								variant="outline"
								size="icon"
								className="h-8 w-8 bg-primary/10 dark:bg-primary/10 border-primary/20 dark:border-primary/20 hover:bg-primary/20 dark:hover:bg-primary/20 text-primary dark:text-primary"
								asChild
							>
								<a href="/resume" aria-label="View resume">
									<FileText size={16} />
								</a>
							</Button>
							<Button variant="outline" size="icon" className="h-8 w-8" asChild>
								<a href="mailto:tashif@duck.com" aria-label="Contact">
									<Mail size={16} />
								</a>
							</Button>
						</span>
					</div>
				</CardContent>
			</Card>

			<!-- Projects Section -->
			<div id="projects-section">
				<!-- Header Card -->
				<Card
					className="relative border-gray-200/60 dark:border-gray-800/60 bg-white/70 dark:bg-gray-900/50 backdrop-blur mb-6 hidden md:block"
				>
					<CardContent className="p-5 flex items-center gap-4">
						<div
							class="p-2.5 rounded-xl bg-primary/10 dark:bg-primary/10 text-primary dark:text-primary ring-1 ring-primary/20"
						>
							<Code2 className="w-5 h-5" />
						</div>
						<div class="flex-1">
							<h2
								class="text-xl font-semibold text-gray-900 dark:text-white mb-1"
							>
								Projects Showcase
							</h2>
							<p class="text-sm text-gray-600 dark:text-gray-400">
								A curated collection of things I've built – open source
								libraries, experiments and product work.
							</p>
						</div>
						<div class="flex flex-wrap gap-2">
							<Badge variant="secondary" className="text-xs">
								{numProjects} Total
							</Badge>
							<Badge variant="secondary" className="text-xs">
								{liveProjectCount} Live
							</Badge>
						</div>
					</CardContent>
				</Card>

				<ProjectFilters client:load starLists={starLists} />
				<div
					class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 auto-rows-fr"
				>
					{
						projects.map((project) => (
							<div
								class="h-full"
								data-project-item-card
								data-has-live-link={Boolean(project.live_website_url)}
							>
								<ProjectCard project={project} />
							</div>
						))
					}
				</div>
			</div>

			<!-- Blog Section -->
			<div id="blog-section" class="hidden relative">
				<!-- Header Card -->
				<Card
					className="relative border-gray-200/60 dark:border-gray-800/60 bg-white/70 dark:bg-gray-900/50 backdrop-blur mb-6 hidden md:block"
				>
					<CardContent className="p-5 flex items-center gap-4">
						<div
							class="p-2.5 rounded-xl bg-primary/10 dark:bg-primary/10 text-primary dark:text-primary ring-1 ring-primary/20"
						>
							<BookOpen className="w-5 h-5" />
						</div>
						<div class="flex-1">
							<h2
								class="text-xl font-semibold text-gray-900 dark:text-white mb-1"
							>
								Latest Articles
							</h2>
							<p class="text-sm text-gray-600 dark:text-gray-400">
								Insights, tutorials & engineering notes – concise thoughts on
								building modern web experiences.
							</p>
						</div>
						<div class="flex flex-wrap gap-2">
							<Badge variant="secondary" className="text-xs">
								{numBlogPosts} Posts
							</Badge>
							<Badge variant="secondary" className="text-xs">
								{avgReadingMinutes} min read
							</Badge>
						</div>
					</CardContent>
				</Card>
				<BlogFilters client:load categories={blogCategories} />
				{
					blogPosts.length > 0 ? (
						<div class="space-y-10">
							<section class="mb-4">
								<BlogCard post={blogPosts[0]} variant="featured" index={0} />
							</section>
							<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5">
								{blogPosts.slice(1).map((post, idx) => (
									<BlogCard post={post} variant="default" index={idx + 1} />
								))}
							</div>
							<div class="pt-10">
								<Card className="mx-auto max-w-xl text-center border-dashed border-gray-300/60 dark:border-gray-700/60 bg-white/60 dark:bg-gray-900/50 backdrop-blur">
									<CardContent className="p-6 space-y-4">
										<h3 class="text-lg font-semibold text-gray-900 dark:text-white">
											Want to read more?
										</h3>
										<p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
											Explore the full archive for in‑depth guides &
											architecture notes. New posts are published regularly.
										</p>
										<Button
											variant="outline"
											className="border-primary/40 bg-primary/10 text-primary dark:text-primary hover:bg-primary/15 dark:border-primary/40"
											asChild
										>
											<a
												href="https://blog.tashif.codes"
												target="_blank"
												rel="noopener noreferrer"
											>
												Visit Blog <ExternalLink size={16} className="ml-2" />
											</a>
										</Button>
									</CardContent>
								</Card>
							</div>
						</div>
					) : (
						<div class="text-center py-14">
							<div class="inline-flex flex-col items-center gap-4 p-8 rounded-2xl bg-white/70 dark:bg-gray-900/50 backdrop-blur border border-gray-200/60 dark:border-gray-700/60">
								<div class="w-14 h-14 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center">
									<ExternalLink className="w-7 h-7 text-gray-400 dark:text-gray-500" />
								</div>
								<h3 class="text-base font-semibold text-gray-900 dark:text-white">
									No posts available
								</h3>
								<p class="text-gray-600 dark:text-gray-300 text-sm max-w-md">
									Unable to load blog posts from the external API. Try again
									later or visit the blog directly.
								</p>
								<Button
									variant="link"
									className="text-primary dark:text-primary"
									asChild
								>
									<a
										href="https://blog.tashif.codes"
										target="_blank"
										rel="noopener noreferrer"
									>
										Visit blog <ExternalLink size={15} className="ml-1" />
									</a>
								</Button>
							</div>
						</div>
					)
				}
			</div>

			<!-- LeetCode Section -->
			<div id="leetcode-section" class="hidden space-y-8">
				<!-- Header Card -->
				<Card
					className="relative border-gray-200/60 dark:border-gray-800/60 bg-white/70 dark:bg-gray-900/50 backdrop-blur hidden md:block"
				>
					<CardContent className="p-5 flex items-center gap-4 justify-between">
						<div class="flex items-center gap-4">
							<div
								class="p-2.5 rounded-xl bg-primary/10 dark:bg-primary/10 text-primary dark:text-primary ring-1 ring-primary/20"
							>
								<Trophy className="w-5 h-5" />
							</div>
							<div>
								<h2
									class="text-xl font-semibold text-gray-900 dark:text-white mb-1"
								>
									LeetCode Profile
								</h2>
								<p class="text-sm text-gray-600 dark:text-gray-400">
									Progress, contests and achievement highlights.
								</p>
							</div>
						</div>
						<div class="flex gap-2">
							<Button
								size="sm"
								className="bg-primary hover:bg-primary/90 text-primary-foreground"
								asChild
							>
								<a href="/leetcode">
									Full Page <ExternalLink size={14} className="ml-1.5" />
								</a>
							</Button>
						</div>
					</CardContent>
				</Card>

				<!-- Core Stats -->
				<LeetCodeStats />

				<!-- Secondary Panels -->
				<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
					<!-- Contests Panel -->
					<LeetCodeContests />

					<!-- Badges Panel -->
					<LeetCodeBadges />
				</div>
			</div>

			<!-- GitHub Section -->
			<div id="github-section" class="hidden space-y-8">
				<!-- Header Card -->
				<Card
					className="relative border-gray-200/60 dark:border-gray-800/60 bg-white/70 dark:bg-gray-900/50 backdrop-blur hidden md:block"
				>
					<CardContent className="p-5 flex items-center gap-4 justify-between">
						<div class="flex items-center gap-4">
							<div
								class="p-2.5 rounded-xl bg-primary/10 dark:bg-primary/10 text-primary dark:text-primary ring-1 ring-primary/20"
							>
								<Github className="w-5 h-5" />
							</div>
							<div>
								<h2
									class="text-xl font-semibold text-gray-900 dark:text-white mb-1"
								>
									GitHub Profile
								</h2>
								<p class="text-sm text-gray-600 dark:text-gray-400">
									Open source velocity, activity and language distribution.
								</p>
							</div>
						</div>
						<div class="flex gap-2">
							<Button
								size="sm"
								className="bg-primary hover:bg-primary/90 text-primary-foreground"
								asChild
							>
								<a href="/github">
									Full Page <ExternalLink size={14} className="ml-1.5" />
								</a>
							</Button>
						</div>
					</CardContent>
				</Card>

				<!-- Stats + Graph / Languages etc. -->
				<GitHubStats />

				<!-- Callout: View Starred Lists in Projects -->
				<Card
					className="border-primary/50 dark:border-primary/40 bg-primary/5 dark:bg-primary/10 backdrop-blur"
				>
					<CardContent
						className="p-5 flex flex-col sm:flex-row items-start sm:items-center gap-4"
					>
						<div class="flex items-center gap-3">
							<BarChart3 className="w-5 h-5 text-primary dark:text-primary" />
							<h3
								class="text-sm font-semibold text-primary dark:text-primary tracking-tight"
							>
								Star Lists → Filter Projects
							</h3>
						</div>
						<p
							class="text-xs text-primary/80 dark:text-primary/70 flex-1 leading-relaxed"
						>
							Jump to a curated repository list in the Projects tab. Selecting a
							list will auto‑filter the grid.
						</p>
						<Button
							data-open-projects
							size="sm"
							className="bg-primary hover:bg-primary/90 text-primary-foreground"
						>
							Open Projects
						</Button>
					</CardContent>
				</Card>
			</div>

			<!-- Resume Section -->
			<div id="resume-section" class="hidden">
				<Resume />
			</div>

			<!-- Community Section -->
			<div id="community-section" class="hidden">
				<div class="mb-8">
					<h2
						class="text-3xl font-bold tracking-tight bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent mb-2"
					>
						Community
					</h2>
					<p class="text-gray-600 dark:text-gray-300">
						Connect with the developer community
					</p>
				</div>

				<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
					<Card className="hover:shadow-lg transition-all duration-300">
						<CardContent className="p-6">
							<div class="flex items-center space-x-3 mb-4">
								<Github className="w-6 h-6 text-gray-600 dark:text-gray-400" />
								<h3 class="text-lg font-semibold text-gray-900 dark:text-white">
									GitHub
								</h3>
							</div>
							<p class="text-gray-600 dark:text-gray-300 mb-4">
								Follow my open source projects and contributions
							</p>
							<Button
								variant="link"
								className="text-primary dark:text-primary p-0 h-auto"
								asChild
							>
								<a
									href="https://github.com/tashifkhan"
									target="_blank"
									rel="noopener noreferrer"
								>
									Visit Profile <ExternalLink size={16} className="ml-1" />
								</a>
							</Button>
						</CardContent>
					</Card>

					<Card className="hover:shadow-lg transition-all duration-300">
						<CardContent className="p-6">
							<div class="flex items-center space-x-3 mb-4">
								<Twitter className="w-6 h-6 text-gray-600 dark:text-gray-400" />
								<h3 class="text-lg font-semibold text-gray-900 dark:text-white">
									Twitter
								</h3>
							</div>
							<p class="text-gray-600 dark:text-gray-300 mb-4">
								Follow for tech updates and coding insights
							</p>
							<Button
								variant="link"
								className="text-primary dark:text-primary p-0 h-auto"
								asChild
							>
								<a
									href="https://twitter.com/khan_tashif_"
									target="_blank"
									rel="noopener noreferrer"
								>
									Follow <ExternalLink size={16} className="ml-1" />
								</a>
							</Button>
						</CardContent>
					</Card>

					<Card className="hover:shadow-lg transition-all duration-300">
						<CardContent className="p-6">
							<div class="flex items-center space-x-3 mb-4">
								<Linkedin
									className="w-6 h-6 text-gray-600 dark:text-gray-400"
								/>
								<h3 class="text-lg font-semibold text-gray-900 dark:text-white">
									LinkedIn
								</h3>
							</div>
							<p class="text-gray-600 dark:text-gray-300 mb-4">
								Connect professionally and view my experience
							</p>
							<Button
								variant="link"
								className="text-orange-600 dark:text-orange-400 p-0 h-auto"
								asChild
							>
								<a
									href="https://www.linkedin.com/in/tashif-ahmad-khan-982304244/"
									target="_blank"
									rel="noopener noreferrer"
								>
									Connect <ExternalLink size={16} className="ml-1" />
								</a>
							</Button>
						</CardContent>
					</Card>
				</div>

				<!-- Contact Me Form -->
				<div class="mt-12">
					<div class="max-w-2xl">
						<h3
							class="text-2xl font-bold tracking-tight bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent mb-3"
						>
							Contact Me
						</h3>
						<p
							class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed mb-6"
						>
							Have a question, collaboration idea or just want to say hi? Drop a
							quick note below. Submitting will open your default email client
							with a pre‑filled message (no data is stored here).
						</p>
						<Card
							className="bg-white/70 dark:bg-gray-900/60 backdrop-blur border-gray-200/60 dark:border-gray-800/60"
						>
							<CardContent className="p-6">
								<form id="contact-form" class="space-y-5" autocomplete="on">
									<div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
										<div class="flex flex-col gap-1.5">
											<Label htmlFor="contact-name">Name</Label>
											<Input
												id="contact-name"
												name="name"
												type="text"
												placeholder="Jane Doe"
												className="bg-white/80 dark:bg-gray-900/70"
											/>
										</div>
										<div class="flex flex-col gap-1.5">
											<Label htmlFor="contact-email">Email</Label>
											<Input
												id="contact-email"
												name="email"
												type="email"
												required
												placeholder="you@example.com"
												className="bg-white/80 dark:bg-gray-900/70"
											/>
										</div>
									</div>
									<div class="flex flex-col gap-1.5">
										<Label htmlFor="contact-subject">Subject</Label>
										<Input
											id="contact-subject"
											name="subject"
											type="text"
											placeholder="Opportunity to collaborate"
											className="bg-white/80 dark:bg-gray-900/70"
										/>
									</div>
									<div class="flex flex-col gap-1.5">
										<Label htmlFor="contact-message">Message</Label>
										<Textarea
											id="contact-message"
											name="message"
											required
											rows={5}
											placeholder="Hi Tashif, I wanted to reach out because..."
											className="resize-y bg-white/80 dark:bg-gray-900/70"
										/>
									</div>
									<div
										class="flex items-center justify-between gap-4 flex-wrap"
									>
										<p
											id="contact-status"
											class="text-xs text-gray-500 dark:text-gray-500"
										>
										</p>
										<Button
											type="submit"
											className="bg-orange-600 hover:bg-orange-500 text-white"
										>
											<span>Open Email Client</span>
											<Mail size={16} className="ml-2" />
										</Button>
									</div>
								</form>
							</CardContent>
						</Card>
					</div>
				</div>
			</div>
		</main>

		<!-- Scroll to top button -->
		<Button
			id="scroll-top-btn"
			type="button"
			size="icon"
			className="fixed bottom-6 right-6 z-40 h-11 w-11 rounded-full shadow-md opacity-0 pointer-events-none transition-all"
			aria-label="Scroll to top"
		>
			<ArrowUp size={18} />
		</Button>
	</div>
</Layout>

<script>
	// Tab switching logic
	const tabs = {
		projects: document.getElementById("projects-tab"),
		blog: document.getElementById("blog-tab"),
		leetcode: document.getElementById("leetcode-tab"),
		github: document.getElementById("github-tab"),
		resume: document.getElementById("resume-tab"),
		community: document.getElementById("community-tab"),
	};

	const sections = {
		projects: document.getElementById("projects-section"),
		blog: document.getElementById("blog-section"),
		leetcode: document.getElementById("leetcode-section"),
		github: document.getElementById("github-section"),
		resume: document.getElementById("resume-section"),
		community: document.getElementById("community-section"),
	};

	function activateTab(
		tabId: "projects" | "blog" | "leetcode" | "github" | "resume" | "community"
	) {
		Object.entries(tabs).forEach(([key, tab]) => {
			if (!tab) return;
			tab.setAttribute("data-state", "inactive");
		});

		const activeTab = tabs[tabId];
		if (activeTab) {
			activeTab.setAttribute("data-state", "active");
		}

		Object.values(sections).forEach((section) => {
			if (!section) return;
			section.classList.add("hidden");
		});

		const activeSection = sections[tabId];
		if (activeSection) {
			activeSection.classList.remove("hidden");
		}
	}

	tabs.projects?.addEventListener("click", () => activateTab("projects"));
	tabs.blog?.addEventListener("click", () => activateTab("blog"));
	tabs.leetcode?.addEventListener("click", () => activateTab("leetcode"));
	tabs.github?.addEventListener("click", () => activateTab("github"));
	tabs.resume?.addEventListener("click", () => activateTab("resume"));
	tabs.community?.addEventListener("click", () => activateTab("community"));

	// Enhanced search functions
	function fuzzySearch(text: string, query: string): boolean {
		if (!query.trim()) return true;

		const textLower = text.toLowerCase();
		const queryLower = query.toLowerCase();

		// Exact match check
		if (textLower.includes(queryLower)) return true;

		// Fuzzy match using character sequence
		let queryIndex = 0;
		for (
			let i = 0;
			i < textLower.length && queryIndex < queryLower.length;
			i++
		) {
			if (textLower[i] === queryLower[queryIndex]) {
				queryIndex++;
			}
		}

		// If we found all characters in sequence, it's a fuzzy match
		return queryIndex === queryLower.length;
	}

	function enhancedSearch(
		text: string,
		query: string,
		exactOnly: boolean
	): boolean {
		if (!query.trim()) return true;

		const textLower = text.toLowerCase();
		const queryLower = query.toLowerCase();

		console.log(`Enhanced search: "${text}" vs "${query}"`);

		// 1. Exact substring match (highest priority)
		if (textLower.includes(queryLower)) {
			console.log("  -> Exact match found");
			return true;
		}

		// If exactOnly flag, skip deeper fuzzy logic
		if (exactOnly) return false;

		// 2. Word boundary match (matches whole words)
		const words = textLower.split(/\s+/);
		const queryWords = queryLower.split(/\s+/);

		// Check if all query words are found in text words
		const allWordsFound = queryWords.every((queryWord) =>
			words.some((word) => word.includes(queryWord))
		);
		if (allWordsFound) {
			console.log("  -> Word boundary match found");
			return true;
		}

		// 3. Fuzzy match (for typos and partial matches)
		const fuzzyResult = fuzzySearch(textLower, queryLower);
		console.log("  -> Fuzzy match result:", fuzzyResult);
		return fuzzyResult;
	}

	// Project search and filter functionality (exact matches first, then fuzzy)
	document.addEventListener("project-search", (e: Event) => {
		const { term: searchTerm, showLiveOnly, list } = (e as CustomEvent).detail;
		const query = (searchTerm || "").trim().toLowerCase();
		const projectCards = Array.from(
			document.querySelectorAll("[data-project-item-card]")
		);
		let liveProjectCount = 0;
		const exactMatches: HTMLElement[] = [];
		const fuzzyMatches: HTMLElement[] = [];

		projectCards.forEach((cardEl, index) => {
			const card = cardEl as HTMLElement;
			const title =
				card.querySelector("[data-project-title]")?.textContent || "";
			const description =
				card.querySelector("[data-project-description]")?.textContent || "";
			const languages = Array.from(
				card.querySelectorAll("[data-project-language]")
			).map((l) => l.textContent || "");
			const fields = [title, description, ...languages].map((f) =>
				f.toLowerCase()
			);
			const hasLiveLink =
				card.querySelector("[data-live-link]") !== null ||
				card.getAttribute("data-has-live-link") === "true";
			if (hasLiveLink) liveProjectCount++;

			// Star list filtering
			let listFilter = true;
			if (list && list !== "all-projects") {
				const repoName = card
					.querySelector("[data-github-link]")
					?.getAttribute("data-url")
					?.split("/")
					?.pop();
				// @ts-ignore
				const starLists = window.__STAR_LISTS__ as
					| { name: string; repositories?: string[] }[]
					| undefined;
				const selected = starLists?.find((l) => l.name === list);
				const repoNames = (selected?.repositories || []).map((r) =>
					r.split("/").pop()
				);
				listFilter = repoName ? repoNames.includes(repoName) : false;
			}

			let isExact = false;
			let isFuzzy = false;
			if (!query) {
				isExact = true; // treat empty query as exact so we skip reordering
			} else {
				isExact = fields.some((f) => f.includes(query));
				if (!isExact) {
					isFuzzy = fields.some((f) => fuzzySearch(f, query));
				}
			}

			const liveFilter = !showLiveOnly || hasLiveLink;
			const matches = (isExact || isFuzzy) && liveFilter && listFilter;
			card.style.display = matches ? "" : "none";

			if (matches) {
				if (isExact) exactMatches.push(card);
				else if (isFuzzy) fuzzyMatches.push(card);
			}
		});

		// Re-order DOM for non-empty queries: exact first then fuzzy
		if (query && projectCards.length) {
			const gridContainer = (projectCards[0] as HTMLElement).parentElement;
			if (gridContainer) {
				const frag = document.createDocumentFragment();
				exactMatches.forEach((card) => frag.appendChild(card));
				fuzzyMatches.forEach((card) => frag.appendChild(card));
				gridContainer.appendChild(frag);
			}
		}
	});

	// When a starred list is requested from GitHub section
	document.addEventListener("open-star-list", (e: Event) => {
		const name = (e as CustomEvent).detail?.name as string | undefined;
		if (!name) return;
		activateTab("projects");
		// store temporarily for ProjectFilters hydration listener
		localStorage.setItem("pending_star_list_select", name);
		// Attempt to update select if already mounted
		setTimeout(() => {
			const select = document.querySelector(
				"[data-project-list-select]"
			) as HTMLSelectElement | null;
			if (select) {
				select.value = name;
				select.dispatchEvent(new Event("change", { bubbles: true }));
			}
		}, 80);
	});

	// Blog search and filter functionality (title + tags)
	document.addEventListener("blog-search", (e: Event) => {
		const searchTerm = (e as CustomEvent).detail.term;
		const blogCards = document.querySelectorAll("[data-blog-card]");

		console.log("Blog search triggered with term:", searchTerm);
		console.log("Found blog cards:", blogCards.length);

		blogCards.forEach((card, index) => {
			const title = card.querySelector("[data-blog-title]")?.textContent || "";
			const tags = Array.from(card.querySelectorAll("[data-blog-tag]")).map(
				(el) => el.textContent || ""
			);

			console.log(
				`Card ${index}: title="${title}", tags=${JSON.stringify(tags)}`
			);

			// Use enhanced search for better matching
			const titleMatch = enhancedSearch(title, searchTerm, false);
			const tagMatch = tags.some((t) => enhancedSearch(t, searchTerm, false));

			const matches = titleMatch || tagMatch;
			console.log(
				`Card ${index} matches: ${matches} (titleMatch: ${titleMatch}, tagMatch: ${tagMatch})`
			);

			(card as HTMLElement).style.display = matches ? "block" : "none";
		});
	});

	document.addEventListener("blog-category", (e: Event) => {
		const categories = (e as CustomEvent).detail.categories as string[];
		const blogCards = document.querySelectorAll("[data-blog-card]");

		console.log("Blog category filter triggered with categories:", categories);
		console.log("Found blog cards:", blogCards.length);

		blogCards.forEach((card, index) => {
			const tags = (card.getAttribute("data-blog-tags") || "")
				.split(",")
				.filter(Boolean);

			// Match if "all" is selected OR if any of the selected categories matches any of the post's tags
			const matches =
				categories.includes("all") ||
				categories.some((cat) => tags.includes(cat));

			console.log(
				`Card ${index}: tags=${JSON.stringify(tags)}, matches: ${matches}`
			);

			(card as HTMLElement).style.display = matches ? "block" : "none";
		});
	});

	// Initialize filters and handle link clicks
	document.addEventListener("DOMContentLoaded", () => {
		const theme = localStorage.getItem("theme") || "dark";
		document.documentElement.classList.toggle("dark", theme === "dark");

		// Initialize project filters with default state
		const projectCards = document.querySelectorAll("[data-project-item-card]");
		console.log(
			"Initializing project filters with",
			projectCards.length,
			"cards"
		);

		// Count live projects for debugging
		let liveProjectCount = 0;
		projectCards.forEach((card) => {
			const hasLiveLink =
				card.querySelector("[data-live-link]") !== null ||
				card.getAttribute("data-has-live-link") === "true";
			if (hasLiveLink) liveProjectCount++;
		});
		console.log("Total live projects found:", liveProjectCount);

		// Apply initial filter state (show all projects by default)
		const initialSearchEvent = new CustomEvent("project-search", {
			detail: { term: "", showLiveOnly: false },
		});
		document.dispatchEvent(initialSearchEvent);

		// Handle live link clicks
		document.querySelectorAll("[data-live-link]").forEach((link) => {
			link.addEventListener("click", (e) => {
				e.preventDefault();
				e.stopPropagation();
				const url = (link as HTMLElement).getAttribute("data-url");
				if (url) {
					window.open(url, "_blank");
				}
			});
			link.addEventListener("keydown", (e) => {
				const key = (e as KeyboardEvent).key;
				if (key === "Enter" || key === " ") {
					e.preventDefault();
					(link as HTMLElement).click();
				}
			});
		});

		// Handle GitHub link clicks
		document.querySelectorAll("[data-github-link]").forEach((link) => {
			link.addEventListener("click", (e) => {
				e.preventDefault();
				e.stopPropagation();
				const url = (link as HTMLElement).getAttribute("data-url");
				if (url) {
					window.open(url, "_blank");
				}
			});
			link.addEventListener("keydown", (e) => {
				const key = (e as KeyboardEvent).key;
				if (key === "Enter" || key === " ") {
					e.preventDefault();
					(link as HTMLElement).click();
				}
			});
		});

		// Welcome banner minimal hide/restore (persisted)
		const WELCOME_KEY = "welcome_hidden";
		const welcomeBanner = document.getElementById("welcome-banner");
		const welcomeDismiss = document.getElementById("welcome-dismiss");
		const welcomeRestore = document.getElementById("welcome-restore");
		const welcomeRestoreBtn = document.getElementById("welcome-restore-btn");

		const applyWelcomeState = (hidden: boolean) => {
			if (!welcomeBanner || !welcomeRestore) return;
			welcomeBanner.classList.toggle("hidden", hidden);
			welcomeRestore.classList.toggle("hidden", !hidden);
		};

		const storedHidden = localStorage.getItem(WELCOME_KEY) === "1";
		applyWelcomeState(storedHidden);

		welcomeDismiss?.addEventListener("click", () => {
			localStorage.setItem(WELCOME_KEY, "1");
			applyWelcomeState(true);
		});

		welcomeRestoreBtn?.addEventListener("click", () => {
			localStorage.removeItem(WELCOME_KEY);
			applyWelcomeState(false);
		});

		// Default to projects tab on load
		activateTab("projects");

		// Scroll-to-top button visibility
		const scrollBtn = document.getElementById("scroll-top-btn");
		if (scrollBtn) {
			const onScroll = () => {
				const show = window.scrollY > 400;
				scrollBtn.classList.toggle("opacity-100", show);
				scrollBtn.classList.toggle("pointer-events-auto", show);
				scrollBtn.classList.toggle("opacity-0", !show);
				scrollBtn.classList.toggle("pointer-events-none", !show);
			};
			window.addEventListener("scroll", onScroll, { passive: true });
			onScroll();
			scrollBtn.addEventListener("click", () => {
				window.scrollTo({ top: 0, behavior: "smooth" });
			});
		}

		// Contact form mailto handler
		const contactForm = document.getElementById(
			"contact-form"
		) as HTMLFormElement | null;
		if (contactForm) {
			contactForm.addEventListener("submit", (e) => {
				e.preventDefault();
				const name =
					(
						document.getElementById("contact-name") as HTMLInputElement | null
					)?.value.trim() || "";
				const email =
					(
						document.getElementById("contact-email") as HTMLInputElement | null
					)?.value.trim() || "";
				const subjectRaw =
					(
						document.getElementById(
							"contact-subject"
						) as HTMLInputElement | null
					)?.value.trim() || "";
				const messageRaw =
					(
						document.getElementById(
							"contact-message"
						) as HTMLTextAreaElement | null
					)?.value.trim() || "";
				const statusEl = document.getElementById("contact-status");

				if (!email || !messageRaw) {
					if (statusEl) statusEl.textContent = "Email & message are required.";
					return;
				}

				// Basic email heuristic
				if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
					if (statusEl)
						statusEl.textContent = "Please provide a valid email address.";
					return;
				}

				const subject =
					subjectRaw || `Message from ${name || "Website Visitor"}`;
				const bodyLines = [
					`Name: ${name || "(not provided)"}`,
					`Email: ${email}`,
					"",
					messageRaw,
					"",
					"---",
					"Sent via dashboard contact form",
				];
				const body = encodeURIComponent(bodyLines.join("\n"));
				const mailto = `mailto:tashif@duck.com?subject=${encodeURIComponent(subject)}&body=${body}`;

				if (statusEl) statusEl.textContent = "Opening your email client...";
				window.location.href = mailto;
			});
		}
	});
</script>
